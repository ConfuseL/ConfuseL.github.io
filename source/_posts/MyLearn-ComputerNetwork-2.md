---
title: <学习记录>《图解TCP/IP》之TCP/IP基础知识
date: 2019-4-2 21:25:21
tags: 知识总结
categories: 计算机网络
copyright: true
keywords: [TCI/IP参考模型,计算机网络,基础知识]
description: 本篇总结了TCP/IP参考模型，引用书中发送邮件的例子去理解应用层、传输层、网络层、数据链路层在传输中的功能和流程。
---
# TCP/IP基础知识

## TCP/IP的具体含义

> 根据不同的使用范围，可以分为两种含义。
>
> 1. 仅TCP和IP两种协议。
> 2. 利用IP进行通信时所必须用到的协议群的统称。如IP/ICMP、 TCP/UDP、 TELNET/FTP等等。

## TCP/IP协议分层模型

> 书本第一章介绍了OSI参考模型（[博客也记录了](http://confusel.tech/2019/MyLearn-ComputerNetwork-1/)），而TCP/IP也有一个对应的参考模型。

![](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1554144143456&di=e4800c52402be45f2a526ef57971e844&imgtype=0&src=http%3A%2F%2Fwww.net130.com%2FCMS%2FFiles%2FUploadimages%2F111744de017.jpg)

> 可以简单的理解为，TCP/IP参考模型将OSI参考模型的顶上三层，即应用层、 表示层、 会话层概括为应用层，其余层不变。也就从原来的7层变为5层模型。
>
> 这里不多介绍数据链路层和物理层了，直接从网络层的协议讲起。

------

### 网络层

> **让主机与主机之间通信。**

#### IP协议

> IP是跨越网络传输数据包，使整个互联网都能收到数据的协议。IP协议使数据能够发送到对方，在发送的期间，以IP地址作为主机的标识符。
>
> IP包含数据链路层的功能，通过IP可以经过任意的底层数据链路去实现通信。
>
> IP是分组交换的一种协议，但是不具有重发机制，所以是非可靠性传输协议。

#### ICMP协议

> ICMP用于在IP数据包发送异常时，向发送端发送一个err，可以用来诊断网络的健康状况。

#### ARP协议

> 可以从IP地址 解析出MAC地址。

------

### 传输层

> **让应用和应用之间通信。**

#### TCP协议

> 面向连接的传输层协议。
>
> 可靠的传输，能保证两个主机之间的通信可达。
>
> 能够正确处理传输过程的丢包、 传输顺序错乱的异常情况。
>
> 可以有效利用带宽，缓解网络拥堵。

> 为了实现可靠性，定义了很多规范，因此在传输上的数据量就不是很大，因此不适合一些数据量大且频繁传输，例如视频通话。

#### UDP协议

> 面向无连接的传输层协议。
>
> 不可靠的传输，它不会关心对方是否能收到数据。
>
> 如果需要检查，只能在应用中实现而不是协议中。

> 性质与TCP大部分相反，因此它适合用于多播、 广播以及视频通信。

------

### 应用层

> 如上面所述，TCP/IP将OSI中的表示层、 会话层、 应用层一起概括为应用层，所以在TCP/IP的应用层中，它要实现OSI三层的功能。
>
> 传输层的 UDP 报文和 TCP 报文段的数据部分就是应用层交付的数据。
>
> 网络管理([SNMP](<https://baike.baidu.com/item/SNMP/133378?fr=aladdin>))在这里不介绍，因为本人不是很了解。

#### WWW功能

> 即万维网，简称web。一般由web客户端(如浏览器)和web服务器组成。而它们之间传输的数据格式主要是[HTML](<https://baike.baidu.com/item/HTML/97049?fr=aladdin>)，即超文本标记语言，通信使用的协议是[HTTP](<https://baike.baidu.com/item/http>)协议，即超文本传输协议。
>
> 注意：HTTP属于OSI应用层协议，HTML属于表示层协议。

#### 电子邮件功能(E-Mail)

> 就是发送电子邮件，使用到的协议叫做[STMP](<https://baike.baidu.com/item/SMTP>)，即简单邮件传输协议，在上一篇博客举例中提到过。
>
> 原来只可以发送文本格式的邮件，在[MIME](<https://baike.baidu.com/item/MIME/2900607?fr=aladdin>)协议出现后，允许发送音频、图像等。甚至能对邮件的文字格式进行更改。
>
> STMP是传输邮件的协议(还有[POP3](<https://baike.baidu.com/item/POP3>))，而MIME是邮件格式的协议，不用弄混了。

#### 文件传输功能(FTP)

> 允许两个计算机之间相互传输文件，可以选择传输过程是二进制还是文本方式。
>
> 在传输过程中，需要创建两个TCP连接，分别是发出传输请求的控制连接，以及实际的数据连接。

#### 远程登录功能(TELNET|SSH)

> 远程登录的作用就不多介绍了，其中telnet是明文发送的数据，而ssh支持加密，所以普遍来说ssh更安全。

## TCP/IP分层模型与通信示例

> 跟着书上的内容，在这里介绍应用层到物理媒介的数据处理流程。

![](https://confusel-images.oss-cn-shenzhen.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E5%BA%93/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%95%B0%E6%8D%AE%E5%8C%85%E9%A6%96%E9%83%A8.png)

> 如上图，我们从下往上看，传输层在上层包装好的数据中添加了自己的TCP首部信息，传递给下一层网络层，网络层也添加了自己的IP首部。
>
> 如同在上一篇博客的发邮件例子的过程中，发送方的邮件数据从表示层开始每一层都为数据添加一个首部信息，代表了它们在这一层的操作规定。
>
> 我们在这里依然和书上一样，使用发邮件的例子介绍它们的封装流程。

### 邮件样例

> 当发送方输入好内容，点击发送的时候。
>
> 1. TCP/IP的应用层开始对邮件进行编码处理，将它变成网络的通用码。(这一步在OSI中是表示层的功能)。邮件开始发送的那一刻，开始建立TCP连接，即从应用层将数据发给下一层传输层的TCP中。
> 2. TCP为了实现可靠性传输的功能，在应用层数据的前端加上了一个TCP首部，上面记录了源端口号和目的端口号，以及数据的序列号和校验和，处理好这些，它将数据发到网络层的IP中。
>
> ![](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1554802825&di=a59b9bf0b19ce7c3bbf57c595728c19c&imgtype=jpg&er=1&src=http%3A%2F%2Fupload-images.jianshu.io%2Fupload_images%2F1653926-8d8b9e2591e664e1.png)
>
> ​	上图的数据即**应用层数据**。
>
> 3. 网络层接受到了数据，对于网络层，它把接受到的数据当作一个整体处理，它直接在这些数据的头部上加入IP首部，上面注明了源地址和目的地址。
>
> ![img](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1554208303275&di=6b2e1b41a598f4619c8d71267b5812c2&imgtype=0&src=http%3A%2F%2Fyzhtml01.book118.com%2F2016%2F11%2F24%2F20%2F44911243%2F10.files%2Ffile0001.png)
>
> ​	上图的数据部分即(**应用层数据加上TCP头部信息**)的数据。
>
> 4. 这个时候，开始把数据发送给数据链路层(如路由器)，这时候我们需要知道接受方的MAC地址(如网卡地址)，我们可以通过ARP协议解析出MAC地址。

![](https://confusel-images.oss-cn-shenzhen.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E5%BA%93/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCPIP%E4%B8%BE%E4%BE%8B.png)



<center>书上的图，该图对包首做了简化</center>

### 数据包接收处理

![](https://confusel-images.oss-cn-shenzhen.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E5%BA%93/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%95%B0%E6%8D%AE%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)

#### 数据链路层

> 接收到数据之后，数据链路层先查看接收端MAC地址是不是自己，如果不是则丢弃。
>
> 确定是自己的包以后，开始查找以太网包首部的类型域，以确定传过来的数据类型。当前的例子是IP包，所以我们会把数据传输给网络层的IP模块中，如果是ARP则给ARP。

#### 网络层

> 例子中的网络层的IP模块接受到下一层(数据链路层)的数据，首先判断目的ip地址是不是自己，如果不是则丢弃。
>
> 确定是自己的包以后，开始查找IP包首部的协议，如果是TCP则给传输层的TCP模块，如果是UDP则给传输层的UDP模块。

#### 传输层

> 例子中的传输层TCP模块接受到下一层(网络层)的数据，这个时候已经确定信息就是发送给自己了，因此不需要再确认。但是需要检验一下校验和，避免数据错误，之后查看端口号，将数据传给对应端口号的进程。同时发送一个ACK，代表接受到数据。
>
> 如果校验和不对，也会向发送方要求重发一次数据，或者是没有向发送方发送ACK，发送方也会反复发送。

#### 应用层

> 我们接受到了传输层的数据，这个时候开始解析(对应OSI的表示层)数据，如果数据正常，并且磁盘有空间能正常保存，那么会发送一个处理正常的信息给发送方。
>
> 否则：
>
> 1. 如果数据实际上并不是指向接受方，比如邮件的收件人地址并不是接受方，那么会发送一个err给发送方。
> 2. 如果接收到了，但是无法正常存储，也会发送一个err。

> 最后接受方打开邮件，看到了发送方发来的信息。

## 总结

> 书上第二章主要就是介绍TCP/IP参考模型以及几个层中相对重要的协议，依然通过发送邮件的例子让读者了解在TCP/IP参考模型中的数据传输流程。
>
> 在发送过程中，传输层，网络层，数据链路层都会在应用层的数据包上加上一层对应的首包，分别标记端口、ip地址、mac地址。
>
> 而接收过程，则逆序解析，一一对正，只要不符合就丢弃。
>
> 最后的解析出原本的数据在应用层上被正确的使用，在这个过程中还回确保信息无误，与发送方确认。

> **书上第三章是数据链路层，个人仅去了解，不会专门总结一篇知识，所以下一次会跳到网络层的ip协议。**